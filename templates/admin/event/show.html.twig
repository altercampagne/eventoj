{% extends 'admin/_base.html.twig' %}

{% set title = event.name %}

{% block main %}
    <div class="row">
        <div class="col-12 col-md-3">
            {% embed 'admin/_cards/event.html.twig' with { event: event } only %}
                {% block content %}
                    {{ parent() }}

                    <ul class="list-group">
                        <li class="list-group-item">
                            <i class="fa-solid fa-ticket fa-fw me-1"></i>
                            Inscriptions le {{ event.openingDateForBookings|format_datetime('long', 'short') }}
                        </li>
                        <li class="list-group-item">
                            <i class="fa-solid fa-file-invoice-dollar fa-fw me-1"></i>
                            Paheko Project ID :
                            {% if event.pahekoProjectId is not null %}
                                <a href="{{ pahekoBaseUri }}/admin/acc/reports/journal.php?project={{ event.pahekoProjectId }}">{{ event.pahekoProjectId }}</a>
                            {% else %}
                                -
                            {% endif %}
                        </li>
                        {% if event.isPublished %}
                            <li class="list-group-item">
                                <i class="fa-solid fa-clock fa-fw me-1"></i>
                                Publié le {{ event.publishedAt|format_datetime('long', 'short') }}
                            </li>
                        {% endif %}
                    </ul>
                {% endblock %}

                {% block footer %}
                    <div class="d-grid gap-2 p-2">
                        {% if is_granted(constant('App\\Admin\\Security\\Permission::EVENT_UPDATE').value, event) %}
                            <a href="{{ path('admin_event_update', { slug: event.slug }) }}" class="btn btn-outline-primary">Modifier l'évènement</a>
                        {% endif %}

                        {% if not event.isPublished and is_granted(constant('App\\Admin\\Security\\Permission::EVENT_PUBLISH').value, event) %}
                            <twig:ButtonPostWithConfirmation
                                url="{{ path('admin_event_publish', { slug: event.slug }) }}"
                                buttonLabel="Publier l'évènement"
                                buttonClass="btn btn-outline-success"
                                modalTitle="Confirmation de la publication"
                                modalButtonClass="btn btn-warning"
                                modalButtonLabel="J'ai bien compris et je confirme la publication de l'évènement."
                            >
                                <div class="alert alert-danger">
                                    La publication de l'évènement est <b>IRRÉVERSIBLE</b> !<br />
                                </div>
                                <p>
                                    L'évènement sera immédiatement visible par tout le monde et les inscriptions seront ouvertes à partir du <b>{{ event.openingDateForBookings|format_datetime('long', 'short') }}</b>.
                                </p>
                            </twig:ButtonPostWithConfirmation>
                        {% endif %}
                    </div>
                {% endblock %}
            {% endembed %}

            <div class="p-2 text-secondary">
                <small>
                    Créé le <b>{{ event.createdAt|format_datetime('long', 'short') }}</b><br />
                    Dernière mise à jour le {{ event.updatedAt|format_datetime('long', 'short') }}
                </small>
            </div>
        </div>

        <div class="col-12 col-md-9">
            <ul class="nav nav-tabs">
                {% if is_granted(constant('App\\Admin\\Security\\Permission::EVENT_VIEW_STAGES').value, event) %}
                    <li class="nav-item">
                        <a class="nav-link{% if tab == 'stages' %} active{% endif %}" href="{{ path('admin_event_show_stages', { slug: event.slug }) }}">
                            Étapes
                        </a>
                    </li>
                {% endif %}

                {% if is_granted(constant('App\\Admin\\Security\\Permission::EVENT_VIEW_REGISTRATIONS').value, event) %}
                    <li class="nav-item">
                        <a class="nav-link{% if tab == 'registrations' %} active{% endif %}{% if event.registrations|length == 0 %} disabled{% endif %}" href="{{ path('admin_event_show_registrations', { slug: event.slug }) }}">
                            Inscriptions
                        </a>
                    </li>
                {% endif %}

                {% if is_granted(constant('App\\Admin\\Security\\Permission::EVENT_VIEW_FILLING').value, event) %}
                    <li class="nav-item">
                        <a class="nav-link{% if tab == 'filling' %} active{% endif %}{% if event.registrations|length == 0 %} disabled{% endif %}" href="{{ path('admin_event_show_filling', { slug: event.slug }) }}">
                            Remplissage
                        </a>
                    </li>
                {% endif %}

                {% if is_granted(constant('App\\Admin\\Security\\Permission::EVENT_VIEW_MEALS').value, event) %}
                    <li class="nav-item">
                        <a class="nav-link{% if tab == 'meals' %} active{% endif %}{% if event.registrations|length == 0 %} disabled{% endif %}" href="{{ path('admin_event_show_meals', { slug: event.slug }) }}">
                            Repas
                        </a>
                    </li>
                {% endif %}

                {% if is_granted(constant('App\\Admin\\Security\\Permission::EVENT_VIEW_ARRIVALS').value, event) %}
                    <li class="nav-item">
                        <a class="nav-link{% if tab == 'arrivals' %} active{% endif %}{% if event.registrations|length == 0 %} disabled{% endif %}" href="{{ path('admin_event_show_arrivals', { slug: event.slug }) }}">
                            Arrivées / départs
                        </a>
                    </li>
                {% endif %}
            </ul>
            <div class="border border-top-0 border-secondary-outline rounded-bottom p-3">
                {% block tab_content '' %}
            </div>
        </div>
    </div>
{% endblock %}
